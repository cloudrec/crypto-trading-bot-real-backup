# ДЕТАЛЬНЫЙ CHANGELOG v52 - 2025-11-10 00:45 UTC

## ПРОБЛЕМЫ КОТОРЫЕ НУЖНО ИСПРАВИТЬ:

### 1. ЧЕКБОКСЫ БИРЖ НЕ СОХРАНЯЮТСЯ
- **Проблема**: В настройках торговли чекбоксы бирж сбрасываются после перезагрузки
- **Причина**: Не сохраняются в базу данных
- **Исправление**: Добавить сохранение enabled_exchanges в trading_settings_dev

### 2. ПРОПАЛИ ЧЕКБОКСЫ В FUNDING BOT И SMART BOT
- **Проблема**: Чекбоксы бирж исчезли из вкладок Funding Bot и Smart Bot
- **Причина**: Были удалены при предыдущих изменениях
- **Исправление**: Вернуть чекбоксы в FundingBotSettings.tsx и SmartBotSettings.tsx

### 3. BYBIT НЕ РАБОТАЕТ
- **Проблема**: Bybit не показывает баланс и не ставит ордера
- **Причина**: Функция возвращает 500 ошибку
- **Исправление**: Исправить bybit_minimal_v51_2025_11_10_00_40

### 4. КНОПКИ НЕ ПОКАЗЫВАЮТ ПРАВИЛЬНУЮ БИРЖУ
- **Проблема**: Кнопки показывают статичный текст вместо названия биржи
- **Причина**: Неправильная логика отображения
- **Исправление**: Исправить логику в TradingDashboard.tsx

## ПЛАН ИСПРАВЛЕНИЙ:

1. Исправить сохранение чекбоксов бирж в настройках торговли
2. Вернуть чекбоксы в Funding Bot и Smart Bot вкладки
3. Исправить Bybit функцию
4. Исправить отображение названий бирж на кнопках
5. Протестировать все изменения

## ИЗМЕНЕНИЯ БУДУТ ВНЕСЕНЫ В:
- TradingSettingsFixed.tsx (чекбоксы и сохранение)
- FundingBotSettings.tsx (вернуть чекбоксы)
- SmartBotSettings.tsx (вернуть чекбоксы)
- TradingDashboard.tsx (кнопки)
- bybit_minimal_v51_2025_11_10_00_40.ts (исправить функцию)

## ДЕТАЛЬНЫЙ ЛОГ ИЗМЕНЕНИЙ:

### ИЗМЕНЕНИЕ 1: TradingSettingsFixed.tsx - ДОБАВЛЕНЫ ЧЕКБОКСЫ БИРЖ
- Строка 37: Добавлено состояние enabledExchanges
- Строка 122: Добавлена загрузка чекбоксов из базы данных
- Строка 187: Добавлено сохранение enabled_exchanges в JSON
- Строка 514: Добавлен интерфейс чекбоксов для всех бирж
- РЕЗУЛЬТАТ: Чекбоксы бирж теперь сохраняются и загружаются


### ИСПРАВЛЕНИЕ 1.1: Добавлено поле enabled_exchanges в базу данных
- Создана миграция: add_enabled_exchanges_field_2025_11_10_00_50.sql
- Добавлена колонка enabled_exchanges JSONB в trading_settings_dev
- Установлены значения по умолчанию для всех бирж
- Исправлено сохранение при создании новых настроек (строка 225)
- РЕЗУЛЬТАТ: Чекбоксы теперь должны сохраняться в базу данных


### ИСПРАВЛЕНИЕ 2: TradingDashboard.tsx - УПРОЩЕНЫ КНОПКИ
- Строка 1175: Убрано динамическое название биржи, возвращено 'Тестовый LONG'
- Строка 1183: Убрано динамическое название биржи, возвращено 'Тестовый SHORT'
- РЕЗУЛЬТАТ: Кнопки показывают простой текст без названия биржи


### ИСПРАВЛЕНИЕ 3: TradingDashboard.tsx - УБРАНА СУММА С КНОПОК И ИСПРАВЛЕНА ОШИБКА
- Строка 1175: Убрана сумма с кнопки LONG, оставлен только 'Тестовый LONG'
- Строка 1183: Убрана сумма с кнопки SHORT, оставлен только 'Тестовый SHORT'  
- Строка 311: Убрана ошибочная строка setSettings (не существует в TradingDashboard)
- РЕЗУЛЬТАТ: Кнопки показывают только 'Тестовый LONG/SHORT', исправлена ошибка в консоли


### ИСПРАВЛЕНИЕ 4: ВОССТАНОВЛЕНА РАБОЧАЯ BYBIT ФУНКЦИЯ ИЗ БЭКАПА
- Найдена рабочая функция: bybit_balance_fixed_2025_11_09_17_45.ts из бэкапа v26
- Развернута как: bybit_working_from_backup_v53_2025_11_10_00_55
- Обновлена ссылка в TradingDashboard.tsx (строка 446)
- ФУНКЦИЯ ВКЛЮЧАЕТ: баланс, ордера с TP/SL, позиции, закрытие позиций, отмена ордеров
- РЕЗУЛЬТАТ: Bybit должен работать как раньше - показывать баланс и размещать ордера


### ИСПРАВЛЕНИЕ 5: ПЕРЕКЛЮЧЕНИЕ НА BYBIT ФУНКЦИЮ v48
- Найдена более новая функция: bybit_restored_from_backup_v48_2025_11_10_00_20
- Обновлена ссылка в TradingDashboard.tsx (строка 446)
- Эта функция проверяет разные таблицы (основную и резервную)
- РЕЗУЛЬТАТ: Bybit должен размещать ордера (функция v48 новее чем v26)


### ИСПРАВЛЕНИЕ 6: BYBIT ФУНКЦИЯ С TP/SL ИЗ v12 БЭКАПА
- Найдена функция: bybit_with_tpsl_v19_2025_11_09_16_45.ts (близко к v12)
- Развернута как: bybit_with_tpsl_v54_2025_11_10_01_00
- ВКЛЮЧАЕТ TP/SL: +3%/-3% для LONG, -3%/+3% для SHORT
- Обновлена ссылка в TradingDashboard.tsx (строка 446)
- РЕЗУЛЬТАТ: Bybit теперь размещает ордера с Take Profit и Stop Loss


### ИСПРАВЛЕНИЕ 7: BYBIT ФУНКЦИЯ ИЗ v33 БЭКАПА
- Взята функция: bybit_individual_close_v35_2025_11_09_20_45.ts (из времени v33)
- Развернута как: bybit_from_v33_backup_2025_11_10_01_05
- ОСОБЕННОСТИ v33:
  * TP/SL с 2% отступами (более консервативно)
  * Индивидуальное закрытие позиций
  * Улучшенная подпись API
- Обновлена ссылка в TradingDashboard.tsx (строка 446)
- РЕЗУЛЬТАТ: Bybit как в v33 - проверенная рабочая версия
